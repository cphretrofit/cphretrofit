<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Module Five: Ventilation Exam</title>
    <style>
        @import url('https://fonts.googleapis.com/css2?family=Inter:wght@300;400;500;600;700&display=swap');
        
        :root {
            --primary: #1e3a5f;
            --secondary: #2c5282;
            --accent: #48bb78;
            --danger: #e53e3e;
            --warning: #ed8936;
            --info: #4299e1;
            --bg: #f7fafc;
            --card: #ffffff;
            --text: #2d3748;
            --border: #e2e8f0;
        }

        * {
            margin: 0;
            padding: 0;
            box-sizing: border-box;
        }

        body {
            font-family: 'Inter', sans-serif;
            background: linear-gradient(135deg, #667eea 0%, #764ba2 100%);
            min-height: 100vh;
            color: var(--text);
            line-height: 1.6;
        }

        .container {
            max-width: 900px;
            margin: 0 auto;
            padding: 20px;
        }

        .header {
            text-align: center;
            color: white;
            margin-bottom: 30px;
            animation: fadeInDown 0.8s ease;
        }

        .header h1 {
            font-size: 2.2rem;
            font-weight: 700;
            margin-bottom: 10px;
        }

        .header p {
            font-size: 1.1rem;
            opacity: 0.9;
        }

        .exam-card {
            background: var(--card);
            border-radius: 20px;
            box-shadow: 0 20px 60px rgba(0,0,0,0.3);
            overflow: hidden;
            animation: fadeInUp 0.8s ease;
        }

        .timer-bar {
            position: fixed;
            top: 0;
            left: 0;
            right: 0;
            height: 6px;
            background: var(--border);
            z-index: 1000;
        }

        .timer-fill {
            height: 100%;
            background: linear-gradient(90deg, var(--accent), #38a169);
            transition: width 1s linear;
            width: 100%;
        }

        .timer-fill.warning {
            background: linear-gradient(90deg, var(--warning), #dd6b20);
        }

        .timer-fill.danger {
            background: linear-gradient(90deg, var(--danger), #c53030);
        }

        .timer-display {
            position: fixed;
            top: 20px;
            right: 20px;
            background: white;
            padding: 12px 24px;
            border-radius: 50px;
            box-shadow: 0 4px 20px rgba(0,0,0,0.15);
            font-weight: 700;
            font-size: 1.2rem;
            color: var(--primary);
            z-index: 999;
            display: flex;
            align-items: center;
            gap: 10px;
        }

        .timer-display.warning {
            color: var(--warning);
            animation: pulse 1s infinite;
        }

        .timer-display.danger {
            color: var(--danger);
            animation: pulse 0.5s infinite;
        }

        .progress-bar {
            height: 6px;
            background: var(--border);
            margin-top: 6px;
        }

        .progress-fill {
            height: 100%;
            background: var(--secondary);
            transition: width 0.4s ease;
            width: 0%;
        }

        .exam-content {
            padding: 40px;
        }

        .question-header {
            display: flex;
            justify-content: space-between;
            align-items: center;
            margin-bottom: 25px;
            padding-bottom: 20px;
            border-bottom: 2px solid var(--border);
        }

        .question-number {
            font-size: 0.9rem;
            color: var(--secondary);
            font-weight: 600;
            text-transform: uppercase;
            letter-spacing: 1px;
        }

        .section-badge {
            background: var(--primary);
            color: white;
            padding: 6px 16px;
            border-radius: 20px;
            font-size: 0.85rem;
            font-weight: 500;
        }

        .question-text {
            font-size: 1.2rem;
            font-weight: 600;
            color: var(--text);
            margin-bottom: 25px;
            line-height: 1.5;
        }

        .options {
            display: flex;
            flex-direction: column;
            gap: 12px;
        }

        .option {
            position: relative;
            padding: 18px 20px 18px 60px;
            border: 2px solid var(--border);
            border-radius: 12px;
            cursor: pointer;
            transition: all 0.3s ease;
            background: white;
            font-size: 1.05rem;
        }

        .option:hover {
            border-color: var(--secondary);
            transform: translateX(5px);
            box-shadow: 0 4px 12px rgba(0,0,0,0.05);
        }

        .option.selected {
            border-color: var(--secondary);
            background: #ebf8ff;
        }

        .option input {
            position: absolute;
            left: 20px;
            top: 50%;
            transform: translateY(-50%);
            width: 24px;
            height: 24px;
            cursor: pointer;
        }

        .option-label {
            font-weight: 500;
            color: var(--text);
        }

        .navigation {
            display: flex;
            justify-content: space-between;
            margin-top: 40px;
            gap: 15px;
        }

        .btn {
            padding: 14px 32px;
            border: none;
            border-radius: 10px;
            font-size: 1rem;
            font-weight: 600;
            cursor: pointer;
            transition: all 0.3s ease;
            display: flex;
            align-items: center;
            gap: 8px;
        }

        .btn-primary {
            background: var(--primary);
            color: white;
        }

        .btn-primary:hover:not(:disabled) {
            background: var(--secondary);
            transform: translateY(-2px);
            box-shadow: 0 10px 20px rgba(30, 58, 95, 0.3);
        }

        .btn-secondary {
            background: var(--border);
            color: var(--text);
        }

        .btn-secondary:hover:not(:disabled) {
            background: #cbd5e0;
        }

        .btn:disabled {
            opacity: 0.5;
            cursor: not-allowed;
        }

        .btn-warning {
            background: var(--warning);
            color: white;
        }

        .btn-warning:hover {
            background: #dd6b20;
        }

        .start-screen, .results-container {
            padding: 50px 40px;
            text-align: center;
        }

        .start-screen h2 {
            font-size: 2rem;
            color: var(--primary);
            margin-bottom: 20px;
        }

        .exam-info {
            display: grid;
            grid-template-columns: repeat(auto-fit, minmax(200px, 1fr));
            gap: 20px;
            margin: 30px 0;
        }

        .info-card {
            background: #f7fafc;
            padding: 25px;
            border-radius: 12px;
            border: 2px solid var(--border);
        }

        .info-card h3 {
            color: var(--primary);
            font-size: 2rem;
            margin-bottom: 5px;
        }

        .info-card p {
            color: #718096;
            font-size: 0.95rem;
        }

        .rules-box {
            background: #fffaf0;
            border-left: 4px solid var(--warning);
            padding: 25px;
            border-radius: 8px;
            text-align: left;
            margin: 30px 0;
        }

        .rules-box h3 {
            color: var(--warning);
            margin-bottom: 15px;
        }

        .rules-box ul {
            margin-left: 20px;
            color: #744210;
        }

        .rules-box li {
            margin-bottom: 10px;
        }

        .score-circle {
            width: 200px;
            height: 200px;
            border-radius: 50%;
            margin: 0 auto 30px;
            display: flex;
            flex-direction: column;
            justify-content: center;
            align-items: center;
            animation: scaleIn 0.6s ease;
        }

        .score-circle.pass {
            background: linear-gradient(135deg, #48bb78, #38a169);
            color: white;
            box-shadow: 0 10px 40px rgba(72, 187, 120, 0.4);
        }

        .score-circle.fail {
            background: linear-gradient(135deg, #e53e3e, #c53030);
            color: white;
            box-shadow: 0 10px 40px rgba(229, 62, 62, 0.4);
        }

        .score-circle.resit {
            background: linear-gradient(135deg, #ed8936, #dd6b20);
            color: white;
            box-shadow: 0 10px 40px rgba(237, 137, 54, 0.4);
        }

        .score-number {
            font-size: 3.5rem;
            font-weight: 700;
            line-height: 1;
        }

        .score-label {
            font-size: 1.1rem;
            margin-top: 5px;
            opacity: 0.9;
        }

        .result-message {
            font-size: 1.8rem;
            font-weight: 700;
            margin-bottom: 10px;
        }

        .result-details {
            color: #718096;
            margin-bottom: 30px;
            font-size: 1.1rem;
            line-height: 1.6;
        }

        .review-section {
            text-align: left;
            margin-top: 40px;
            max-height: 600px;
            overflow-y: auto;
            border-top: 2px solid var(--border);
            padding-top: 30px;
        }

        .review-item {
            background: #f7fafc;
            border-radius: 12px;
            padding: 20px;
            margin-bottom: 15px;
            border-left: 4px solid transparent;
        }

        .review-item.correct {
            border-left-color: var(--accent);
            background: #f0fff4;
        }

        .review-item.wrong {
            border-left-color: var(--danger);
            background: #fff5f5;
        }

        .review-header {
            display: flex;
            justify-content: space-between;
            margin-bottom: 10px;
            font-weight: 600;
            align-items: center;
        }

        .review-status {
            padding: 6px 14px;
            border-radius: 20px;
            font-size: 0.85rem;
            font-weight: 700;
        }

        .review-status.correct {
            background: #c6f6d5;
            color: #22543d;
        }

        .review-status.wrong {
            background: #fed7d7;
            color: #742a2a;
        }

        .review-question {
            font-weight: 600;
            color: #2d3748;
            margin-bottom: 10px;
        }

        .review-answer {
            font-size: 0.95rem;
            color: #4a5568;
            margin-top: 8px;
            padding: 10px;
            background: rgba(255,255,255,0.5);
            border-radius: 8px;
        }

        .correct-answer {
            color: #22543d;
            font-weight: 600;
        }

        .your-answer {
            color: #742a2a;
        }

        .explanation {
            margin-top: 10px;
            padding: 12px;
            background: white;
            border-radius: 8px;
            font-size: 0.9rem;
            color: #4a5568;
            border-left: 3px solid var(--info);
        }

        .resit-warning {
            background: #fffaf0;
            border: 2px solid var(--warning);
            border-radius: 12px;
            padding: 20px;
            margin: 20px 0;
            color: #744210;
        }

        .hidden {
            display: none !important;
        }

        @keyframes fadeInDown {
            from { opacity: 0; transform: translateY(-20px); }
            to { opacity: 1; transform: translateY(0); }
        }

        @keyframes fadeInUp {
            from { opacity: 0; transform: translateY(20px); }
            to { opacity: 1; transform: translateY(0); }
        }

        @keyframes scaleIn {
            from { transform: scale(0.8); opacity: 0; }
            to { transform: scale(1); opacity: 1; }
        }

        @keyframes pulse {
            0%, 100% { transform: scale(1); }
            50% { transform: scale(1.05); }
        }

        @media (max-width: 768px) {
            .header h1 { font-size: 1.6rem; }
            .exam-content { padding: 25px; }
            .question-text { font-size: 1.1rem; }
            .option { padding: 15px 15px 15px 50px; }
            .navigation { flex-direction: column; }
            .btn { width: 100%; justify-content: center; }
            .timer-display { top: 10px; right: 10px; padding: 8px 16px; font-size: 1rem; }
        }
    </style>
</head>
<body>
    <div class="timer-bar">
        <div class="timer-fill" id="timerFill"></div>
    </div>
    
    <div class="timer-display" id="timerDisplay">
        <span>‚è±Ô∏è</span>
        <span id="timeText">60:00</span>
    </div>

    <div class="container">
        <div class="header">
            <h1>üè† CPH Retrofit Certification</h1>
            <p>Module Five: Ventilation and Heating Exam</p>
        </div>

        <div class="exam-card">
            <div class="progress-bar">
                <div class="progress-fill" id="progressFill"></div>
            </div>

            <!-- Start Screen -->
            <div id="startScreen" class="start-screen">
                <h2>Ventilation & Part F Examination</h2>
                <p style="color: #718096; margin-bottom: 30px;">Demonstrate your knowledge of ventilation systems, Part F compliance, and CPH Retrofit standards.</p>
                
                <div class="exam-info">
                    <div class="info-card">
                        <h3>30</h3>
                        <p>Questions</p>
                    </div>
                    <div class="info-card">
                        <h3>70%</h3>
                        <p>Pass Mark<br>(21/30 correct)</p>
                    </div>
                    <div class="info-card">
                        <h3>60</h3>
                        <p>Minutes<br>Time Limit</p>
                    </div>
                    <div class="info-card">
                        <h3>1</h3>
                        <p>Resit<br>Allowed</p>
                    </div>
                </div>

                <div class="rules-box">
                    <h3>‚ö†Ô∏è Examination Rules</h3>
                    <ul>
                        <li>You have <strong>60 minutes</strong> to complete all 30 questions</li>
                        <li>You must achieve <strong>70% (21 correct)</strong> to pass</li>
                        <li>If you fail, you may resit <strong>once</strong> immediately</li>
                        <li>If you fail the resit, you must wait 24 hours and retake the induction</li>
                        <li>The timer cannot be paused once started</li>
                        <li>You can navigate between questions using Previous/Next buttons</li>
                        <li>All answers will be revealed with explanations after submission</li>
                    </ul>
                </div>

                <div style="background: #ebf8ff; border-left: 4px solid var(--info); padding: 20px; border-radius: 8px; text-align: left; margin: 20px 0;">
                    <strong style="color: var(--primary);">Topics Covered:</strong>
                    <ul style="margin-top: 10px; padding-left: 20px; color: #4a5568;">
                        <li>Part F Building Regulations requirements</li>
                        <li>Ventilation system types (MEV, MVHR, Natural)</li>
                        <li>Airflow calculations and commissioning</li>
                        <li>Installation standards and common errors</li>
                        <li>Maintenance procedures and troubleshooting</li>
                        <li>Health and safety considerations</li>
                    </ul>
                </div>

                <button class="btn btn-primary" onclick="startExam()" style="margin-top: 20px; font-size: 1.2rem; padding: 18px 50px;">
                    Start Examination ‚Üí
                </button>
            </div>

            <!-- Exam Screen -->
            <div id="examScreen" class="hidden">
                <div class="exam-content">
                    <div class="question-header">
                        <span class="question-number" id="questionNumber">Question 1 of 30</span>
                        <span class="section-badge" id="sectionBadge">Part F Basics</span>
                    </div>

                    <div class="question-text" id="questionText"></div>

                    <div class="options" id="optionsContainer"></div>

                    <div class="navigation">
                        <button class="btn btn-secondary" id="prevBtn" onclick="previousQuestion()" disabled>
                            ‚Üê Previous
                        </button>
                        <button class="btn btn-primary" id="nextBtn" onclick="nextQuestion()">
                            Next ‚Üí
                        </button>
                    </div>
                </div>
            </div>

            <!-- Results Screen -->
            <div id="resultsScreen" class="results-container hidden">
                <div class="score-circle" id="scoreCircle">
                    <div class="score-number" id="scoreNumber">0%</div>
                    <div class="score-label" id="scoreLabel">Score</div>
                </div>

                <div class="result-message" id="resultMessage"></div>
                <div class="result-details" id="resultDetails"></div>

                <div id="resitSection" class="hidden">
                    <div class="resit-warning">
                        <strong>‚ö†Ô∏è Resit Available</strong>
                        <p>You have one opportunity to resit this exam immediately. The questions will be the same but shuffled.</p>
                    </div>
                    <button class="btn btn-warning" onclick="startResit()" style="margin: 10px;">
                        üîÑ Start Resit Exam
                    </button>
                </div>

                <div style="display: flex; gap: 15px; justify-content: center; margin: 20px 0; flex-wrap: wrap;">
                    <button class="btn btn-primary" onclick="toggleReview()">
                        üìã Review Answers
                    </button>
                    <button class="btn btn-secondary" onclick="restartExam()">
                        üè† Return to Start
                    </button>
                </div>

                <div id="reviewContainer" class="review-section hidden"></div>
            </div>
        </div>
    </div>

    <script>
        const examData = [
            // Part F Basics (Questions 1-5)
            {
                section: "Part F Basics",
                question: "What does Part F of the Building Regulations primarily cover?",
                options: ["Fire safety", "Ventilation", "Structural integrity", "Energy efficiency"],
                answer: 1,
                explanation: "Part F specifically covers ventilation requirements, ensuring adequate air quality and moisture control in buildings."
            },
            {
                section: "Part F Basics",
                question: "Compliance with Part F is:",
                options: ["Optional for retrofit projects", "Recommended but not enforced", "Mandatory and legally required", "Only required for new builds"],
                answer: 2,
                explanation: "Part F compliance is mandatory. Non-compliance can result in enforcement action and liability issues."
            },
            {
                section: "Part F Basics",
                question: "Which document covers ventilation requirements for dwellings?",
                options: ["Part F Volume 1", "Part F Volume 2", "Part L", "Part B"],
                answer: 0,
                explanation: "Part F Volume 1 covers dwellings (houses and flats), while Volume 2 covers buildings other than dwellings."
            },
            {
                section: "Part F Basics",
                question: "What are the three types of ventilation defined in Part F?",
                options: ["Whole dwelling, extract, and purge", "Supply, extract, and balanced", "Natural, mechanical, and hybrid", "Continuous, intermittent, and boost"],
                answer: 0,
                explanation: "Part F defines three types: whole dwelling ventilation (continuous fresh air), extract ventilation (pollutant removal at source), and purge ventilation (rapid occasional ventilation)."
            },
            {
                section: "Part F Basics",
                question: "What is the primary purpose of purge ventilation?",
                options: ["Continuous air supply", "Remove pollutants at source", "Rapid ventilation for occasional use", "Heat recovery"],
                answer: 2,
                explanation: "Purge ventilation provides rapid ventilation for occasional use, typically through openable windows or doors."
            },

            // Ventilation Strategies (Questions 6-10)
            {
                section: "Ventilation Strategies",
                question: "At what airtightness level is MVHR typically recommended?",
                options: ["< 5 m¬≥/hr¬∑m¬≤ @ 50Pa", "< 3 m¬≥/hr¬∑m¬≤ @ 50Pa", "< 7 m¬≥/hr¬∑m¬≤ @ 50Pa", "< 10 m¬≥/hr¬∑m¬≤ @ 50Pa"],
                answer: 1,
                explanation: "MVHR is recommended when airtightness is better than 3 m¬≥/hr¬∑m¬≤ @ 50Pa to ensure heat recovery efficiency."
            },
            {
                section: "Ventilation Strategies",
                question: "What is the main disadvantage of Mechanical Extract Ventilation (MEV)?",
                options: ["High installation cost", "No heat recovery", "Requires no maintenance", "Only works in summer"],
                answer: 1,
                explanation: "MEV extracts warm air without recovering the heat, unlike MVHR which recovers 80-95% of heat."
            },
            {
                section: "Ventilation Strategies",
                question: "Which ventilation strategy requires background ventilators (trickle vents) in habitable rooms?",
                options: ["MVHR", "MEV", "Natural ventilation only", "All mechanical systems"],
                answer: 1,
                explanation: "MEV requires background ventilators to provide fresh air to habitable rooms as it only extracts from wet rooms."
            },
            {
                section: "Ventilation Strategies",
                question: "What is the heat recovery efficiency range for a good MVHR unit?",
                options: ["50-60%", "60-75%", "80-95%", "95-100%"],
                answer: 2,
                explanation: "Modern MVHR units can recover 80-95% of heat from extracted air, making them highly efficient."
            },
            {
                section: "Ventilation Strategies",
                question: "Decentralised MVHR (dMVHR) is best suited for:",
                options: ["Large commercial buildings", "Retrofit where ducting is difficult", "New build passivhaus", "Industrial applications"],
                answer: 1,
                explanation: "dMVHR units are ideal for retrofit where installing ducting is challenging, as they work room-by-room without central ducting."
            },

            // Calculations & Rates (Questions 11-15)
            {
                section: "Calculations & Rates",
                question: "What is the formula for minimum whole dwelling ventilation rate?",
                options: ["0.5 √ó Floor Area + 2 √ó Bedrooms", "0.3 √ó Floor Area + 4 √ó Bedrooms", "0.4 √ó Floor Area + 3 √ó Bedrooms", "0.6 √ó Floor Area + 5 √ó Bedrooms"],
                answer: 1,
                explanation: "The Part F formula is 0.3 √ó Floor Area (m¬≤) + 4 √ó Number of Bedrooms, ensuring adequate fresh air based on space and occupancy."
            },
            {
                section: "Calculations & Rates",
                question: "A 100m¬≤ house with 3 bedrooms requires what minimum whole dwelling ventilation rate?",
                options: ["30 l/s", "36 l/s", "42 l/s", "48 l/s"],
                answer: 2,
                explanation: "Calculation: (0.3 √ó 100) + (4 √ó 3) = 30 + 12 = 42 litres per second."
            },
            {
                section: "Calculations & Rates",
                question: "What is the minimum intermittent extract rate for a kitchen with a cooker hood?",
                options: ["15 l/s", "30 l/s", "45 l/s", "60 l/s"],
                answer: 1,
                explanation: "Part F requires 30 l/s for kitchens with cooker hoods (intermittent use), or 60 l/s without a hood."
            },
            {
                section: "Calculations & Rates",
                question: "What is the maximum Specific Fan Power (SFP) allowed for MVHR systems?",
                options: ["0.4 W/l/s", "0.6 W/l/s", "0.8 W/l/s", "1.0 W/l/s"],
                answer: 1,
                explanation: "Part F requires MVHR systems to have SFP not exceeding 0.6 W/l/s to ensure energy efficiency."
            },
            {
                section: "Calculations & Rates",
                question: "Continuous extract ventilation in a bathroom requires minimum:",
                options: ["4 l/s", "6 l/s", "8 l/s", "10 l/s"],
                answer: 2,
                explanation: "Part F requires 8 l/s continuous extract in bathrooms, or 15 l/s intermittent."
            },

            // Installation Standards (Questions 16-20)
            {
                section: "Installation Standards",
                question: "What type of ducting is preferred for ventilation systems?",
                options: ["Flexible ducting", "Rigid ducting", "PVC pipe", "Aluminium foil"],
                answer: 1,
                explanation: "Rigid ducting is preferred as it maintains smooth airflow. Flexible ducting creates turbulence and resistance if not fully extended."
            },
            {
                section: "Installation Standards",
                question: "Ducting in cold lofts must be:",
                options: ["Painted white", "Insulated", "Grounded", "Sealed with tape only"],
                answer: 1,
                explanation: "Ducting in cold spaces must be insulated (minimum 25mm) to prevent condensation forming on the outside of the duct."
            },
            {
                section: "Installation Standards",
                question: "What is the maximum number of 90¬∞ bends recommended per duct run?",
                options: ["2", "3", "4", "No limit"],
                answer: 1,
                explanation: "Maximum 3 bends per run is recommended. Use swept bends rather than sharp 90¬∞ elbows where possible."
            },
            {
                section: "Installation Standards",
                question: "MVHR intake and exhaust terminals must be positioned:",
                options: ["Next to each other for efficiency", "At least 1 metre apart", "On the same wall", "Inside the building"],
                answer: 1,
                explanation: "Intake and exhaust must be at least 1m apart to prevent recirculation of stale air into the fresh air supply."
            },
            {
                section: "Installation Standards",
                question: "What happens if flexible ducting is not fully extended?",
                options: ["Improved airflow", "Reduced airflow and turbulence", "Better noise reduction", "Increased heat recovery"],
                answer: 1,
                explanation: "Unextended flexible ducting creates ridges that cause turbulence, significantly reducing airflow efficiency."
            },

            // Commissioning (Questions 21-25)
            {
                section: "Commissioning",
                question: "Commissioning of ventilation systems is:",
                options: ["Optional for experienced installers", "Required only for MVHR", "Mandatory for all mechanical systems", "Only needed for warranty"],
                answer: 2,
                explanation: "Commissioning is mandatory for all mechanical ventilation systems under Part F and must be documented."
            },
            {
                section: "Commissioning",
                question: "What must be measured during commissioning?",
                options: ["Only fan speed", "Actual flow rates at each grille", "Room temperature only", "Electricity consumption only"],
                answer: 1,
                explanation: "Actual flow rates must be measured at each supply and extract grille to ensure design rates are achieved."
            },
            {
                section: "Commissioning",
                question: "What document is required after commissioning?",
                options: ["Invoice only", "Commissioning certificate", "Warranty card", "User manual"],
                answer: 1,
                explanation: "A commissioning certificate is mandatory and must be filed with Building Control and project documentation."
            },
            {
                section: "Commissioning",
                question: "Balancing the system means:",
                options: ["Making sure it doesn't fall over", "Adjusting dampers to achieve design flows", "Painting it evenly", "Leveling the unit"],
                answer: 1,
                explanation: "Balancing involves adjusting dampers to ensure each room receives the designed airflow rate."
            },
            {
                section: "Commissioning",
                question: "An uncommissioned system is:",
                options: ["Acceptable if it seems to work", "Non-compliant with Building Regulations", "Covered by insurance", "Eligible for warranty"],
                answer: 1,
                explanation: "An uncommissioned system is non-compliant. CPH Retrofit requires commissioning on every project."
            },

            // Maintenance & Troubleshooting (Questions 26-30)
            {
                section: "Maintenance",
                question: "How often should MVHR filters be changed?",
                options: ["Every month", "Every 3 months", "Every 6-12 months", "Every 2 years"],
                answer: 2,
                explanation: "MVHR filters should be changed every 6-12 months depending on environmental conditions and manufacturer specifications."
            },
            {
                section: "Maintenance",
                question: "What is the first sign that ventilation filters need changing?",
                options: ["System runs quieter", "Reduced airflow or increased noise", "Warmer air supply", "Lower electricity bills"],
                answer: 1,
                explanation: "Blocked filters cause the fan to work harder, resulting in increased noise and reduced airflow."
            },
            {
                section: "Maintenance",
                question: "If occupants report condensation on windows after retrofit, what should you check first?",
                options: ["The heating system", "The ventilation system operation", "The window seals", "The insulation thickness"],
                answer: 1,
                explanation: "Post-retrofit condensation usually indicates inadequate ventilation. Check if the system is running, filters are clean, and boost is being used."
            },
            {
                section: "Maintenance",
                question: "What maintenance task is required annually for MVHR?",
                options: ["Replace the heat exchanger", "Clean or check the heat exchanger", "Replace all ducting", "Paint the unit"],
                answer: 1,
                explanation: "The heat exchanger should be checked annually and cleaned if accessible, though it typically doesn't need replacement."
            },
            {
                section: "Maintenance",
                question: "What is the most common cause of noisy ventilation systems?",
                options: ["Oversized unit", "Blocked filters or loose ducting", "Too much insulation", "High outdoor temperatures"],
                answer: 1,
                explanation: "Noisy systems are usually caused by blocked filters making the fan work harder, or ducting that has come loose and vibrates."
            }
        ];

        let currentQuestion = 0;
        let userAnswers = new Array(examData.length).fill(null);
        let examStarted = false;
        let timeRemaining = 3600; // 60 minutes in seconds
        let timerInterval;
        let attemptNumber = 1;
        let examFinished = false;

        function shuffleArray(array) {
            for (let i = array.length - 1; i > 0; i--) {
                const j = Math.floor(Math.random() * (i + 1));
                [array[i], array[j]] = [array[j], array[i]];
            }
            return array;
        }

        function startExam() {
            document.getElementById('startScreen').classList.add('hidden');
            document.getElementById('examScreen').classList.remove('hidden');
            examStarted = true;
            examFinished = false;
            
            // Shuffle questions for resit
            if (attemptNumber > 1) {
                shuffleArray(examData);
            }
            
            loadQuestion();
            startTimer();
        }

        function startTimer() {
            timerInterval = setInterval(() => {
                timeRemaining--;
                updateTimerDisplay();
                
                if (timeRemaining <= 0) {
                    clearInterval(timerInterval);
                    submitExam(true); // Auto-submit when time runs out
                }
            }, 1000);
        }

        function updateTimerDisplay() {
            const minutes = Math.floor(timeRemaining / 60);
            const seconds = timeRemaining % 60;
            const timeText = `${minutes.toString().padStart(2, '0')}:${seconds.toString().padStart(2, '0')}`;
            document.getElementById('timeText').textContent = timeText;
            document.title = `CPH Exam - ${timeText} remaining`;
            
            const timerFill = document.getElementById('timerFill');
            const timerDisplay = document.getElementById('timerDisplay');
            const percentage = (timeRemaining / 3600) * 100;
            timerFill.style.width = `${percentage}%`;
            
            if (timeRemaining < 300) { // Less than 5 minutes
                timerFill.className = 'timer-fill danger';
                timerDisplay.className = 'timer-display danger';
            } else if (timeRemaining < 600) { // Less than 10 minutes
                timerFill.className = 'timer-fill warning';
                timerDisplay.className = 'timer-display warning';
            }
        }

        function loadQuestion() {
            const data = examData[currentQuestion];
            document.getElementById('questionNumber').textContent = `Question ${currentQuestion + 1} of ${examData.length}`;
            document.getElementById('sectionBadge').textContent = data.section;
            document.getElementById('questionText').textContent = data.question;
            
            const optionsContainer = document.getElementById('optionsContainer');
            optionsContainer.innerHTML = '';
            
            const labels = ['A', 'B', 'C', 'D'];
            data.options.forEach((option, index) => {
                const div = document.createElement('div');
                div.className = 'option';
                if (userAnswers[currentQuestion] === index) {
                    div.classList.add('selected');
                }
                div.onclick = () => selectOption(index);
                div.innerHTML = `
                    <input type="radio" name="answer" ${userAnswers[currentQuestion] === index ? 'checked' : ''}>
                    <span class="option-label"><strong>${labels[index]}.</strong> ${option}</span>
                `;
                optionsContainer.appendChild(div);
            });

            document.getElementById('prevBtn').disabled = currentQuestion === 0;
            
            if (currentQuestion === examData.length - 1) {
                document.getElementById('nextBtn').textContent = 'Submit Exam ‚úì';
            } else {
                document.getElementById('nextBtn').textContent = 'Next ‚Üí';
            }

            updateProgress();
        }

        function selectOption(index) {
            userAnswers[currentQuestion] = index;
            const options = document.querySelectorAll('.option');
            options.forEach((opt, i) => {
                opt.classList.remove('selected');
                if (i === index) opt.classList.add('selected');
                opt.querySelector('input').checked = i === index;
            });
        }

        function previousQuestion() {
            if (currentQuestion > 0) {
                currentQuestion--;
                loadQuestion();
            }
        }

        function nextQuestion() {
            if (currentQuestion < examData.length - 1) {
                currentQuestion++;
                loadQuestion();
            } else {
                submitExam(false);
            }
        }

        function updateProgress() {
            const progress = ((currentQuestion + 1) / examData.length) * 100;
            document.getElementById('progressFill').style.width = `${progress}%`;
        }

        function submitExam(autoSubmit = false) {
            clearInterval(timerInterval);
            examFinished = true;
            
            const unanswered = userAnswers.filter(a => a === null).length;
            if (!autoSubmit && unanswered > 0) {
                if (!confirm(`You have ${unanswered} unanswered question(s). Are you sure you want to submit?`)) {
                    startTimer(); // Resume timer if they cancel
                    return;
                }
            }

            document.getElementById('examScreen').classList.add('hidden');
            document.getElementById('resultsScreen').classList.remove('hidden');
            
            showResults();
        }

        function showResults() {
            let correct = 0;
            userAnswers.forEach((answer, index) => {
                if (answer === examData[index].answer) correct++;
            });

            const percentage = Math.round((correct / examData.length) * 100);
            const passed = percentage >= 70;
            const timeUsed = 3600 - timeRemaining;
            const minutesUsed = Math.floor(timeUsed / 60);
            const secondsUsed = timeUsed % 60;

            const scoreCircle = document.getElementById('scoreCircle');
            const resultMessage = document.getElementById('resultMessage');
            const resultDetails = document.getElementById('resultDetails');
            const resitSection = document.getElementById('resitSection');

            if (passed) {
                scoreCircle.className = 'score-circle pass';
                resultMessage.textContent = 'üéâ Congratulations! You Passed!';
                resultMessage.style.color = '#48bb78';
                resultDetails.innerHTML = `
                    You scored <strong>${correct}/${examData.length} (${percentage}%)</strong><br>
                    Pass mark: 70% (21/30)<br>
                    Time used: ${minutesUsed}m ${secondsUsed}s<br>
                    <span style="color: #48bb78; font-weight: 600;">You are certified in Ventilation & Part F!</span>
                `;
                resitSection.classList.add('hidden');
            } else {
                if (attemptNumber === 1) {
                    scoreCircle.className = 'score-circle resit';
                    resultMessage.textContent = '‚ùå First Attempt Failed';
                    resultMessage.style.color = '#ed8936';
                    resultDetails.innerHTML = `
                        You scored <strong>${correct}/${examData.length} (${percentage}%)</strong><br>
                        Required: 70% (21/30)<br>
                        You need ${21 - correct} more correct answers to pass.<br>
                        <span style="color: #ed8936; font-weight: 600;">You have one resit available.</span>
                    `;
                    resitSection.classList.remove('hidden');
                } else {
                    scoreCircle.className = 'score-circle fail';
                    resultMessage.textContent = '‚ùå Exam Failed';
                    resultMessage.style.color = '#e53e3e';
                    resultDetails.innerHTML = `
                        You scored <strong>${correct}/${examData.length} (${percentage}%)</strong> on your resit.<br>
                        Required: 70% (21/30)<br>
                        <span style="color: #e53e3e; font-weight: 600;">You must wait 24 hours and retake the induction.</span>
                    `;
                    resitSection.classList.add('hidden');
                }
            }

            document.getElementById('scoreNumber').textContent = `${percentage}%`;
            generateReview();
        }

        function generateReview() {
            const container = document.getElementById('reviewContainer');
            container.innerHTML = '<h3 style="margin-bottom: 20px; color: var(--primary); text-align: center;">Detailed Answer Review</h3>';

            userAnswers.forEach((answer, index) => {
                const data = examData[index];
                const isCorrect = answer === data.answer;
                const labels = ['A', 'B', 'C', 'D'];
                
                const reviewItem = document.createElement('div');
                reviewItem.className = `review-item ${isCorrect ? 'correct' : 'wrong'}`;
                
                let yourAnswerText = '';
                if (answer !== null) {
                    yourAnswerText = `${labels[answer]}. ${data.options[answer]}`;
                } else {
                    yourAnswerText = 'No answer selected';
                }
                
                reviewItem.innerHTML = `
                    <div class="review-header">
                        <span style="color: #718096; font-size: 0.9rem;">Question ${index + 1} ‚Ä¢ ${data.section}</span>
                        <span class="review-status ${isCorrect ? 'correct' : 'wrong'}">
                            ${isCorrect ? '‚úì Correct' : '‚úó Incorrect'}
                        </span>
                    </div>
                    <div class="review-question">${data.question}</div>
                    <div class="review-answer your-answer">
                        <strong>Your answer:</strong> ${yourAnswerText}
                    </div>
                    ${!isCorrect ? `
                        <div class="review-answer correct-answer">
                            <strong>Correct answer:</strong> ${labels[data.answer]}. ${data.options[data.answer]}
                        </div>
                    ` : ''}
                    <div class="explanation">
                        <strong>Explanation:</strong> ${data.explanation}
                    </div>
                `;
                
                container.appendChild(reviewItem);
            });
        }

        function toggleReview() {
            const review = document.getElementById('reviewContainer');
            review.classList.toggle('hidden');
            if (!review.classList.contains('hidden')) {
                review.scrollIntoView({ behavior: 'smooth' });
            }
        }

        function startResit() {
            if (attemptNumber >= 2) return;
            
            attemptNumber = 2;
            currentQuestion = 0;
            userAnswers = new Array(examData.length).fill(null);
            timeRemaining = 3600;
            examFinished = false;
            
            // Reset timer display
            document.getElementById('timerFill').className = 'timer-fill';
            document.getElementById('timerDisplay').className = 'timer-display';
            updateTimerDisplay();
            
            document.getElementById('resultsScreen').classList.add('hidden');
            document.getElementById('reviewContainer').classList.add('hidden');
            document.getElementById('examScreen').classList.remove('hidden');
            
            startExam();
        }

        function restartExam() {
            // Reset everything
            attemptNumber = 1;
            currentQuestion = 0;
            userAnswers = new Array(examData.length).fill(null);
            timeRemaining = 3600;
            examStarted = false;
            examFinished = false;
            clearInterval(timerInterval);
            
            document.getElementById('timerFill').className = 'timer-fill';
            document.getElementById('timerDisplay').className = 'timer-display';
            document.getElementById('timeText').textContent = '60:00';
            document.title = 'CPH Retrofit - Ventilation & Part F Certification Exam';
            
            document.getElementById('resultsScreen').classList.add('hidden');
            document.getElementById('examScreen').classList.add('hidden');
            document.getElementById('reviewContainer').classList.add('hidden');
            document.getElementById('startScreen').classList.remove('hidden');
        }

        // Keyboard navigation
        document.addEventListener('keydown', (e) => {
            if (!examStarted || examFinished) return;
            
            if (e.key === 'ArrowLeft' && currentQuestion > 0) {
                previousQuestion();
            } else if (e.key === 'ArrowRight') {
                if (currentQuestion < examData.length - 1) {
                    nextQuestion();
                }
            } else if (e.key >= '1' && e.key <= '4') {
                selectOption(parseInt(e.key) - 1);
            }
        });
    </script>
</body>

</html>
